from unittest import TestCase

import matplotlib.pyplot as plt
import numpy as np
import pandas as pd

from jpt import infer_from_dataframe, JPT
from jpt.plotting.helpers import pdf_grid_3d


class TestJPTPlotting(TestCase):

    def test_pdf_grid(self):
        # Arrange
        df = pd.DataFrame([
            [1, 1.2],
            [1.1, 1.3],
            [3, 4.1],
            [3.2, 3.9]
        ], columns=['x', 'y'])
        jpt = JPT(
            infer_from_dataframe(df, scale_numeric_types=False),
            min_samples_leaf=2
        ).learn(df)
        jpt.plot(view=True, plotvars=jpt.variables)

        # Act
        X, Y, Z = pdf_grid_3d(jpt, 'x', 'y')

        # Assert
        self.assertEqual(
            [0.9999999999999999, 1.0, 1.1, 1.1000000000000003, 2.9999999999999996, 3.0, 3.2, 3.2000000000000006, 0.9999999999999999, 1.0, 1.1, 1.1000000000000003, 2.9999999999999996, 3.0, 3.2, 3.2000000000000006, 0.9999999999999999, 1.0, 1.1, 1.1000000000000003, 2.9999999999999996, 3.0, 3.2, 3.2000000000000006, 0.9999999999999999, 1.0, 1.1, 1.1000000000000003, 2.9999999999999996, 3.0, 3.2, 3.2000000000000006, 0.9999999999999999, 1.0, 1.1, 1.1000000000000003, 2.9999999999999996, 3.0, 3.2, 3.2000000000000006, 0.9999999999999999, 1.0, 1.1, 1.1000000000000003, 2.9999999999999996, 3.0, 3.2, 3.2000000000000006, 0.9999999999999999, 1.0, 1.1, 1.1000000000000003, 2.9999999999999996, 3.0, 3.2, 3.2000000000000006, 0.9999999999999999, 1.0, 1.1, 1.1000000000000003, 2.9999999999999996, 3.0, 3.2, 3.2000000000000006],
            list(X.ravel())
        )
        self.assertEqual(
            [1.1999999999999997, 1.1999999999999997, 1.1999999999999997, 1.1999999999999997, 1.1999999999999997, 1.1999999999999997, 1.1999999999999997, 1.1999999999999997, 1.2, 1.2, 1.2, 1.2, 1.2, 1.2, 1.2, 1.2, 1.3, 1.3, 1.3, 1.3, 1.3, 1.3, 1.3, 1.3, 1.3000000000000003, 1.3000000000000003, 1.3000000000000003, 1.3000000000000003, 1.3000000000000003, 1.3000000000000003, 1.3000000000000003, 1.3000000000000003, 3.8999999999999995, 3.8999999999999995, 3.8999999999999995, 3.8999999999999995, 3.8999999999999995, 3.8999999999999995, 3.8999999999999995, 3.8999999999999995, 3.9, 3.9, 3.9, 3.9, 3.9, 3.9, 3.9, 3.9, 4.1, 4.1, 4.1, 4.1, 4.1, 4.1, 4.1, 4.1, 4.1000000000000005, 4.1000000000000005, 4.1000000000000005, 4.1000000000000005, 4.1000000000000005, 4.1000000000000005, 4.1000000000000005, 4.1000000000000005],
            list(Y.ravel())
        )
        self.assertEqual(
            [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 49.999999999999915, 49.999999999999915, 0.0, 0.0, 0.0, 0.0,
             0.0, 0.0, 49.999999999999915, 49.999999999999915, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
             0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 12.500000000000007,
             12.500000000000007, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 12.500000000000007, 12.500000000000007, 0.0, 0.0, 0.0,
             0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            list(Z.ravel())
        )