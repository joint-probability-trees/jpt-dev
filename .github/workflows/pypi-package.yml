name: Publish the pyjpt package to PyPI and TestPyPI

on:
  workflow_dispatch:
  push:
    branches:
      - main

defaults:
  run:
    shell: bash
    working-directory: .

jobs:
    build-and-publish:
      name: Build and publish Python distribution
      runs-on: ubuntu-22.04
      steps:
          - name: Checkout ğŸ›
            uses: actions/checkout@v3

          - name: Setup python ğŸ
            uses: actions/setup-python@v4
            with:
                python-version: 3.8
                cache: pip

          - name: Install user dependencies ğŸ¼
            uses: py-actions/py-dependency-install@v4
            with:
              path: "requirements.txt"
          - name: Install user dependencies ğŸ“
            uses: py-actions/py-dependency-install@v4
            with:
              path: "requirements-dev.txt"
          - name: Build binary wheel ğŸ”¨
            run: |
              python setup.py bdist_wheel
          - name: Publish distribution to Test PyPI ğŸ“¢
            uses: pypa/gh-action-pypi-publish@master
            with:
                password: ${{ secrets.TEST_PYPI_API_TOKEN }}
                skip_existing: true
                repository_url: https://test.pypi.org/legacy/
